\documentclass[12pt,a4paper]{article}

% -------- Русский и базовые пакеты --------
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}

% -------- Вёрстка / типографика --------
\usepackage{geometry}
\geometry{margin=1.8cm}
\usepackage{microtype}
\usepackage{parskip}
\usepackage{amsmath,amssymb}
\usepackage{booktabs,tabularx,array}
\usepackage{enumitem}
\setlist{nosep,leftmargin=*}
\usepackage{xcolor}
\definecolor{uiAccent}{RGB}{28,114,184}
\definecolor{uiLine}{gray}{0.85}
\usepackage{tcolorbox}
\tcbset{sharp corners, boxrule=0.4pt, colback=white, colframe=uiLine}
\usepackage{pgf}
\usepackage{ifthen}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\cfoot{\thepage}

% ====== НОМЕР СТУДЕНТА (меняйте только это) ======
\newcommand{\studentnumber}{24}
% ================================================

% r = number % 5; если r=0 → вариант 5
\pgfmathparse{mod(\studentnumber,5)}\pgfmathtruncatemacro{\rest}{\pgfmathresult}
\ifthenelse{\equal{\rest}{0}}{\def\variant{5}}{\def\variant{\rest}}

% ---------- Заголовок ----------
\newcommand{\Title}{
  {\Large\bfseries Домашнее задание: «Арифметика свёрточной сети»}\par
  \vspace{2pt}\textcolor{uiLine}{\rule{\linewidth}{0.6pt}}\par
}
\newcommand{\VariantBadge}{
  \begin{tcolorbox}[colback=gray!3]
  \textbf{Студент № \studentnumber} \;→\; \textbf{Вариант \variant}. \;
  Правило: $r=(\text{номер}\bmod 5)$, если $r=0$ — Вариант 5.
  \end{tcolorbox}
}

% ---------- Варианты: входы и короткие списки (для стр.1) ----------
\newcommand{\InputDimVarOne}{$32\times32\times3$}
\newcommand{\InputDimVarTwo}{$28\times28\times1$}
\newcommand{\InputDimVarThree}{$64\times64\times3$}
\newcommand{\InputDimVarFour}{$24\times24\times3$}
\newcommand{\InputDimVarFive}{$32\times32\times1$}
\newcommand{\InputDim}{%
\ifthenelse{\equal{\variant}{1}}{\InputDimVarOne}{%
\ifthenelse{\equal{\variant}{2}}{\InputDimVarTwo}{%
\ifthenelse{\equal{\variant}{3}}{\InputDimVarThree}{%
\ifthenelse{\equal{\variant}{4}}{\InputDimVarFour}{\InputDimVarFive}}}}}

\newcommand{\VariantOneList}{\textbf{Вариант 1} (вход \InputDimVarOne): \begin{itemize}
  \item Conv1: $5\times5$, $s=1$, $p=2$, $C_\text{out}=8$
  \item Conv2: $3\times3$, $s=1$, $p=1$, $C_\text{out}=16$
  \item Max Pooling: $2\times2$, $s=2$
  \item Conv3: $3\times3$, $s=1$, $p=1$, $C_\text{out}=32$
  \item Conv4: $1\times1$, $s=1$, $p=0$, $C_\text{out}=10$
  \item Global Average Pooling → Softmax
\end{itemize}}
\newcommand{\VariantTwoList}{\textbf{Вариант 2} (вход \InputDimVarTwo): \begin{itemize}
  \item Conv1: $3\times3$, $s=1$, $p=1$, $C_\text{out}=6$
  \item Max Pooling: $2\times2$, $s=2$
  \item Conv2: $5\times5$, $s=1$, $p=2$, $C_\text{out}=16$
  \item Max Pooling: $2\times2$, $s=2$
  \item Conv3: $1\times1$, $s=1$, $p=0$, $C_\text{out}=10$
  \item Global Average Pooling → Softmax
\end{itemize}}
\newcommand{\VariantThreeList}{\textbf{Вариант 3} (вход \InputDimVarThree): \begin{itemize}
  \item Conv1: $7\times7$, $s=2$, $p=3$, $C_\text{out}=16$ \emph{(даунсемплинг)}
  \item Max Pooling: $3\times3$, $s=2$, $p=1$
  \item Conv2: $3\times3$, $s=1$, $p=1$, $C_\text{out}=32$
  \item Conv3: $3\times3$, $s=1$, $p=1$, $C_\text{out}=32$
  \item Conv4: $1\times1$, $s=1$, $p=0$, $C_\text{out}=10$
  \item Global Average Pooling → Softmax
\end{itemize}}
\newcommand{\VariantFourList}{\textbf{Вариант 4} (вход \InputDimVarFour): \begin{itemize}
  \item Conv1: $3\times3$, $s=1$, $p=1$, $C_\text{out}=12$
  \item Conv2: $3\times3$, $s=2$, $p=1$, $C_\text{out}=24$ \emph{(даунсемплинг)}
  \item Max Pooling: $2\times2$, $s=2$
  \item Conv3: $1\times1$, $s=1$, $p=0$, $C_\text{out}=10$
  \item Global Average Pooling → Softmax
\end{itemize}}
\newcommand{\VariantFiveList}{\textbf{Вариант 5} (вход \InputDimVarFive): \begin{itemize}
  \item Conv1: $3\times3$, $s=1$, $p=0$, $C_\text{out}=8$ \emph{(valid)}
  \item Max Pooling: $2\times2$, $s=2$
  \item Conv2: $3\times3$, $s=1$, $p=0$, $C_\text{out}=16$ \emph{(valid)}
  \item Conv3: $3\times3$, $s=2$, $p=0$, $C_\text{out}=32$ \emph{(valid + даунсемплинг)}
  \item Conv4: $1\times1$, $s=1$, $p=0$, $C_\text{out}=10$
  \item Global Average Pooling → Softmax
\end{itemize}}

% ---------- Бланковые таблицы как в Задании 1 (для всех заданий) ----------
% Задание 1: размеры (как было)
\newcommand{\SizesSheetVarOne}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & \textbf{Размер выхода $H\times W\times C$}\\
\midrule
— & \textit{Вход}           & — & — & — & — & — & \\
1 & Conv1                    & $5\times5$ & 1 & 2 & 3  & 8  & \\
2 & Max Pooling              & $2\times2$ & 2 & 0 & —  & —  & \\
3 & Conv2                    & $3\times3$ & 1 & 1 & 8  & 16 & \\
4 & Conv3                    & $3\times3$ & 1 & 1 & 16 & 32 & \\
5 & Conv4                    & $1\times1$ & 1 & 0 & 32 & 10 & \\
6 & Global Average Pooling   & —          & — & — & —  & —  & $1\times1\times10$ \\
\bottomrule
\end{tabularx}}
\newcommand{\SizesSheetVarTwo}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & \textbf{Размер выхода $H\times W\times C$}\\
\midrule
— & \textit{Вход}           & — & — & — & — & — & \\
1 & Conv1                    & $3\times3$ & 1 & 1 & 1  & 6  & \\
2 & Max Pooling              & $2\times2$ & 2 & 0 & —  & —  & \\
3 & Conv2                    & $5\times5$ & 1 & 2 & 6  & 16 & \\
4 & Max Pooling              & $2\times2$ & 2 & 0 & —  & —  & \\
5 & Conv3                    & $1\times1$ & 1 & 0 & 16 & 10 & \\
6 & Global Average Pooling   & —          & — & — & —  & —  & $1\times1\times10$ \\
\bottomrule
\end{tabularx}}
\newcommand{\SizesSheetVarThree}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & \textbf{Размер выхода $H\times W\times C$}\\
\midrule
— & \textit{Вход}           & — & — & — & — & — & \\
1 & Conv1                    & $7\times7$ & 2 & 3 & 3  & 16 & \\
2 & Max Pooling              & $3\times3$ & 2 & 1 & —  & —  & \\
3 & Conv2                    & $3\times3$ & 1 & 1 & 16 & 32 & \\
4 & Conv3                    & $3\times3$ & 1 & 1 & 32 & 32 & \\
5 & Conv4                    & $1\times1$ & 1 & 0 & 32 & 10 & \\
6 & Global Average Pooling   & —          & — & — & —  & —  & $1\times1\times10$ \\
\bottomrule
\end{tabularx}}
\newcommand{\SizesSheetVarFour}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & \textbf{Размер выхода $H\times W\times C$}\\
\midrule
— & \textit{Вход}           & — & — & — & — & — & \\
1 & Conv1                    & $3\times3$ & 1 & 1 & 3  & 12 & \\
2 & Conv2                    & $3\times3$ & 2 & 1 & 12 & 24 & \\
3 & Max Pooling              & $2\times2$ & 2 & 0 & —  & —  & \\
4 & Conv3                    & $1\times1$ & 1 & 0 & 24 & 10 & \\
5 & Global Average Pooling   & —          & — & — & —  & —  & $1\times1\times10$ \\
\bottomrule
\end{tabularx}}
\newcommand{\SizesSheetVarFive}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & \textbf{Размер выхода $H\times W\times C$}\\
\midrule
— & \textit{Вход}           & — & — & — & — & — & \\
1 & Conv1                    & $3\times3$ & 1 & 0 & 1  & 8  & \\
2 & Max Pooling              & $2\times2$ & 2 & 0 & —  & —  & \\
3 & Conv2                    & $3\times3$ & 1 & 0 & 8  & 16 & \\
4 & Conv3                    & $3\times3$ & 2 & 0 & 16 & 32 & \\
5 & Conv4                    & $1\times1$ & 1 & 0 & 32 & 10 & \\
6 & Global Average Pooling   & —          & — & — & —  & —  & $1\times1\times10$ \\
\bottomrule
\end{tabularx}}

\newcommand{\ShowSizesSheet}{%
\ifthenelse{\equal{\variant}{1}}{\SizesSheetVarOne}{%
\ifthenelse{\equal{\variant}{2}}{\SizesSheetVarTwo}{%
\ifthenelse{\equal{\variant}{3}}{\SizesSheetVarThree}{%
\ifthenelse{\equal{\variant}{4}}{\SizesSheetVarFour}{\SizesSheetVarFive}}}}}

% ===== Новые листы как в Задании 1 для Заданий 2 и 3 =====
% ПАРАМЕТРЫ (Задание 2): такая же верстка, итоговая колонка — #params
\newcommand{\ParamsSheetVarOne}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & \textbf{\#params}\\
\midrule
1 & Conv1                  & $5\times5$ & 1 & 2 & 3  & 8  & \\
2 & Max Pooling            & $2\times2$ & 2 & 0 & —  & —  & — \\
3 & Conv2                  & $3\times3$ & 1 & 1 & 8  & 16 & \\
4 & Conv3                  & $3\times3$ & 1 & 1 & 16 & 32 & \\
5 & Conv4                  & $1\times1$ & 1 & 0 & 32 & 10 & \\
6 & Global Average Pooling & —          & — & — & —  & —  & — \\
\bottomrule
\end{tabularx}}
\newcommand{\ParamsSheetVarTwo}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & \textbf{\#params}\\
\midrule
1 & Conv1                  & $3\times3$ & 1 & 1 & 1  & 6  & \\
2 & Max Pooling            & $2\times2$ & 2 & 0 & —  & —  & — \\
3 & Conv2                  & $5\times5$ & 1 & 2 & 6  & 16 & \\
4 & Max Pooling            & $2\times2$ & 2 & 0 & —  & —  & — \\
5 & Conv3                  & $1\times1$ & 1 & 0 & 16 & 10 & \\
6 & Global Average Pooling & —          & — & — & —  & —  & — \\
\bottomrule
\end{tabularx}}
\newcommand{\ParamsSheetVarThree}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & \textbf{\#params}\\
\midrule
1 & Conv1                  & $7\times7$ & 2 & 3 & 3  & 16 & \\
2 & Max Pooling            & $3\times3$ & 2 & 1 & —  & —  & — \\
3 & Conv2                  & $3\times3$ & 1 & 1 & 16 & 32 & \\
4 & Conv3                  & $3\times3$ & 1 & 1 & 32 & 32 & \\
5 & Conv4                  & $1\times1$ & 1 & 0 & 32 & 10 & \\
6 & Global Average Pooling & —          & — & — & —  & —  & — \\
\bottomrule
\end{tabularx}}
\newcommand{\ParamsSheetVarFour}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & \textbf{\#params}\\
\midrule
1 & Conv1                  & $3\times3$ & 1 & 1 & 3  & 12 & \\
2 & Conv2                  & $3\times3$ & 2 & 1 & 12 & 24 & \\
3 & Max Pooling            & $2\times2$ & 2 & 0 & —  & —  & — \\
4 & Conv3                  & $1\times1$ & 1 & 0 & 24 & 10 & \\
5 & Global Average Pooling & —          & — & — & —  & —  & — \\
\bottomrule
\end{tabularx}}
\newcommand{\ParamsSheetVarFive}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & \textbf{\#params}\\
\midrule
1 & Conv1                  & $3\times3$ & 1 & 0 & 1  & 8  & \\
2 & Max Pooling            & $2\times2$ & 2 & 0 & —  & —  & — \\
3 & Conv2                  & $3\times3$ & 1 & 0 & 8  & 16 & \\
4 & Conv3                  & $3\times3$ & 2 & 0 & 16 & 32 & \\
5 & Conv4                  & $1\times1$ & 1 & 0 & 32 & 10 & \\
6 & Global Average Pooling & —          & — & — & —  & —  & — \\
\bottomrule
\end{tabularx}}

\newcommand{\ShowParamsSheet}{%
\ifthenelse{\equal{\variant}{1}}{\ParamsSheetVarOne}{%
\ifthenelse{\equal{\variant}{2}}{\ParamsSheetVarTwo}{%
\ifthenelse{\equal{\variant}{3}}{\ParamsSheetVarThree}{%
\ifthenelse{\equal{\variant}{4}}{\ParamsSheetVarFour}{\ParamsSheetVarFive}}}}}

% MACs (Задание 3): такая же верстка, итоговая колонка — MACs (+ место под HxW и k^2)
\newcommand{\MACsSheetVarOne}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}p{2.8cm} c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & $H_\text{out}\!\times\!W_\text{out}$ & $k^2$ & \textbf{MACs}\\
\midrule
1 & Conv1                  & $5\times5$ & 1 & 2 & 3  & 8  & & 25 & \\
2 & Max Pooling            & $2\times2$ & 2 & 0 & —  & —  & — & —  & — \\
3 & Conv2                  & $3\times3$ & 1 & 1 & 8  & 16 & & 9  & \\
4 & Conv3                  & $3\times3$ & 1 & 1 & 16 & 32 & & 9  & \\
5 & Conv4                  & $1\times1$ & 1 & 0 & 32 & 10 & & 1  & \\
6 & Global Average Pooling & —          & — & — & —  & —  & — & —  & — \\
\bottomrule
\end{tabularx}}
\newcommand{\MACsSheetVarTwo}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}p{2.8cm} c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & $H_\text{out}\!\times\!W_\text{out}$ & $k^2$ & \textbf{MACs}\\
\midrule
1 & Conv1                  & $3\times3$ & 1 & 1 & 1  & 6  & & 9  & \\
2 & Max Pooling            & $2\times2$ & 2 & 0 & —  & —  & — & —  & — \\
3 & Conv2                  & $5\times5$ & 1 & 2 & 6  & 16 & & 25 & \\
4 & Max Pooling            & $2\times2$ & 2 & 0 & —  & —  & — & —  & — \\
5 & Conv3                  & $1\times1$ & 1 & 0 & 16 & 10 & & 1  & \\
6 & Global Average Pooling & —          & — & — & —  & —  & — & —  & — \\
\bottomrule
\end{tabularx}}
\newcommand{\MACsSheetVarThree}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}p{2.8cm} c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & $H_\text{out}\!\times\!W_\text{out}$ & $k^2$ & \textbf{MACs}\\
\midrule
1 & Conv1                  & $7\times7$ & 2 & 3 & 3  & 16 & & 49 & \\
2 & Max Pooling            & $3\times3$ & 2 & 1 & —  & —  & — & —  & — \\
3 & Conv2                  & $3\times3$ & 1 & 1 & 16 & 32 & & 9  & \\
4 & Conv3                  & $3\times3$ & 1 & 1 & 32 & 32 & & 9  & \\
5 & Conv4                  & $1\times1$ & 1 & 0 & 32 & 10 & & 1  & \\
6 & Global Average Pooling & —          & — & — & —  & —  & — & —  & — \\
\bottomrule
\end{tabularx}}
\newcommand{\MACsSheetVarFour}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}p{2.8cm} c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & $H_\text{out}\!\times\!W_\text{out}$ & $k^2$ & \textbf{MACs}\\
\midrule
1 & Conv1                  & $3\times3$ & 1 & 1 & 3  & 12 & & 9  & \\
2 & Conv2                  & $3\times3$ & 2 & 1 & 12 & 24 & & 9  & \\
3 & Max Pooling            & $2\times2$ & 2 & 0 & —  & —  & — & —  & — \\
4 & Conv3                  & $1\times1$ & 1 & 0 & 24 & 10 & & 1  & \\
5 & Global Average Pooling & —          & — & — & —  & —  & — & —  & — \\
\bottomrule
\end{tabularx}}
\newcommand{\MACsSheetVarFive}{
\begin{tabularx}{\linewidth}{@{}c l c c c c c >{\centering\arraybackslash}p{2.8cm} c >{\centering\arraybackslash}X @{}}
\toprule
\# & \textbf{Слой} & $k$ & $s$ & $p$ & $C_\text{in}$ & $C_\text{out}$ & $H_\text{out}\!\times\!W_\text{out}$ & $k^2$ & \textbf{MACs}\\
\midrule
1 & Conv1                  & $3\times3$ & 1 & 0 & 1  & 8  & & 9  & \\
2 & Max Pooling            & $2\times2$ & 2 & 0 & —  & —  & — & —  & — \\
3 & Conv2                  & $3\times3$ & 1 & 0 & 8  & 16 & & 9  & \\
4 & Conv3                  & $3\times3$ & 2 & 0 & 16 & 32 & & 9  & \\
5 & Conv4                  & $1\times1$ & 1 & 0 & 32 & 10 & & 1  & \\
6 & Global Average Pooling & —          & — & — & —  & —  & — & —  & — \\
\bottomrule
\end{tabularx}}

\newcommand{\ShowMACsSheet}{%
\ifthenelse{\equal{\variant}{1}}{\MACsSheetVarOne}{%
\ifthenelse{\equal{\variant}{2}}{\MACsSheetVarTwo}{%
\ifthenelse{\equal{\variant}{3}}{\MACsSheetVarThree}{%
\ifthenelse{\equal{\variant}{4}}{\MACsSheetVarFour}{\MACsSheetVarFive}}}}}

% ---------- Страница 1 ----------
\newcommand{\PageOne}{
\Title
\VariantBadge

\begin{tcolorbox}
\textbf{Уникальный вариант.} Вы можете сгенерировать себе уникальный вариант задания. Для этого:
\begin{enumerate}
  \item Откройте tex-файл и найдите строку с "\{studentnumber\}\{24\}".
  \item Замените число на свой номер студента в группе по ведомости.
  \item Сохраните файл и соберите PDF. В серой рамке сверху появится «Студент № "ваш номер" → Вариант "ваш вариант"» - это и есть ваш вариант.
  \item Ничего больше в преамбуле не меняйте:
        архитектура, таблицы и все задания автоматически подстраиваются
        под ваш номер.
\end{enumerate}
\end{tcolorbox}


\begin{tcolorbox}
\textbf{Мотивация.} В свёрточных сетях важно уметь «вручную» оценивать размеры тензоров, число параметров
и вычислительную стоимость. Это помогает проектировать архитектуры, сравнивать модели и понимать, где узкие места.
В этом задании вы всё считаете на бумаге — без кода.
\end{tcolorbox}

\begin{tcolorbox}
\textbf{Что нужно сделать.}
\begin{enumerate}
  \item \textbf{Размеры:} вычислите $H\times W\times C$ \emph{после каждого слоя} вашей сети.
  \item \textbf{Параметры:} посчитайте число параметров (с bias) \emph{каждого свёрточного слоя} и сумму по сети.
  \item \textbf{Вычислительная стоимость:} оцените \textbf{MACs} для \emph{каждого свёрточного слоя} и общую сумму
        (считаем только свёртки; ReLU и Max Pooling игнорируем).
  \item \textbf{Короткий ответ (2–4 предложения):} почему свёртка \emph{эквивариантна} сдвигу,
        а связка \emph{Global Average Pooling + Softmax} повышает \emph{инвариантность} к сдвигам?
\end{enumerate}
\end{tcolorbox}

\textbf{Ваш вариант (зависит от номера студента).}
\begin{tcolorbox}
\ifthenelse{\equal{\variant}{1}}{\VariantOneList}{%
\ifthenelse{\equal{\variant}{2}}{\VariantTwoList}{%
\ifthenelse{\equal{\variant}{3}}{\VariantThreeList}{%
\ifthenelse{\equal{\variant}{4}}{\VariantFourList}{%
\VariantFiveList}}}}
\end{tcolorbox}

\textbf{Что сдаём.} Таблица размеров; таблица параметров; таблица MACs; короткий текст про экви-/инвариантность.
}

% ---------- Страница 2 (справка) ----------
\newcommand{\PageTwo}{
\newpage
\Title
{\large\bfseries Справка}\par\vspace{4pt}

\begin{tcolorbox}
\textbf{Размеры выхода (Conv/Pooling).}
\[
H_{\text{out}}=\left\lfloor\frac{H+2p-k}{s}\right\rfloor+1,\qquad
W_{\text{out}}=\left\lfloor\frac{W+2p-k}{s}\right\rfloor+1.
\]
\end{tcolorbox}

\begin{tcolorbox}
\textbf{Параметры Conv2D (с bias).}\;
\(
\#\text{params}=(k_H k_W C_{\text{in}})\,C_{\text{out}} + C_{\text{out}}.
\)
\end{tcolorbox}

\begin{tcolorbox}
\textbf{MAC и связь с FLOPs.}\;
\emph{MAC (Multiply–ACcumulate)} — операция \(a \leftarrow a + b \times c\).
Для свёртки:
\[
\text{MACs}=H_{\text{out}}\,W_{\text{out}}\,C_{\text{in}}\,k^2\,C_{\text{out}}.
\]
Во многих отчётах \(\text{FLOPs} \approx 2\times\text{MACs}\) (умножение+сложение считаются раздельно).
Конвенции (учёт bias, FMA) могут различаться между фреймворками/статьями.
\end{tcolorbox}

\begin{tcolorbox}
\textbf{Global Average Pooling (глобальное среднее пулинг).}\;
Для карты признаков \(A\in\mathbb{R}^{H\times W\times C}\):
\[
y_c=\frac{1}{HW}\sum_{i=1}^{H}\sum_{j=1}^{W}A_{i,j,c}.
\]
Global Average Pooling убирает координаты (усиливает инвариантность к сдвигам) и не добавляет параметров.
\end{tcolorbox}

\begin{tcolorbox}
\textbf{Конвенции этого ДЗ.}
Свёртка трактуется как кросс-корреляция; ядра квадратные \(k\times k\).
Считаем MACs только для свёрток; ReLU и Max Pooling игнорируем.
\end{tcolorbox}
}

% ---------- Страница 3 (бланк ответов) ----------
\newcommand{\PageThree}{
\newpage
\Title
{\large\bfseries Бланк ответов}\par\vspace{6pt}

% ---- Задание 1: РАЗМЕРЫ ----
\begin{tcolorbox}[title=\bfseries Задание 1. Напишите размеры тензоров после каждого слоя.]
\textbf{На вход тензор:} \InputDim

\vspace{4pt}
\ShowSizesSheet
\end{tcolorbox}

% ---- Задание 2: ПАРАМЕТРЫ — та же верстка, как в Задании 1 ----
\begin{tcolorbox}[title=\bfseries Задание 2. Посчитайте число параметров каждого свёрточного слоя и сумму.]
\textbf{Подсказка по формуле:} $(k^2 C_\text{in})C_\text{out}+C_\text{out}$ (bias учитываем).
\vspace{4pt}

\ShowParamsSheet
\end{tcolorbox}

% ---- Задание 3: MACs — та же верстка, как в Задании 1 ----
\begin{tcolorbox}[title=\bfseries Задание 3. Оцените MACs для каждого свёрточного слоя и общую сумму.]
\textbf{Подсказка по формуле:} $\text{MACs}=H_\text{out}W_\text{out}C_\text{in}k^2C_\text{out}$.
\vspace{4pt}

\ShowMACsSheet
\end{tcolorbox}

% ---- Задание 4: Короткий ответ ----
\begin{tcolorbox}[title=\bfseries Задание 4. Коротко: эквивариантность свёртки и инвариантность от Global Average Pooling + Softmax (2–4 предложения).]
\vspace{2.2cm}
\end{tcolorbox}
}

% ================= DOCUMENT =================
\begin{document}
\PageOne
\PageTwo
\PageThree
\end{document}
